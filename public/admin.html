<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 20px;
    }

    h2 {
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background: #2b2b52;
      color: white;
    }

    tr:nth-child(even) {
      background: #f2f2f2;
    }
    .status {
  padding: 5px 10px;
  border-radius: 20px;
  font-weight: bold;
}

.Pending {
  background: #fff3cd;
  color: #856404;
}

.Approved {
  background: #d4edda;
  color: #155724;
}

.Rejected {
  background: #f8d7da;
  color: #721c24;
}


  </style>
</head>
<body>

<h2>ðŸ“‹ Applications Dashboard</h2>
<input type="text" id="searchInput" placeholder="Search by name, email, or job role..." 
style="width:100%; padding:10px; margin-bottom:15px;">


<table id="applicationsTable">
  <thead>
   <tr>
  <th>Name</th>
  <th>Email</th>
  <th>Phone</th>
  <th>Job Role</th>
  <th>Message</th>
  <th>Submitted At</th>
  <th>Status</th>
  <th>Actions</th>
</tr>

  </thead>
  <tbody>
  </tbody>
</table>

<script>
let applicationsData = [];

async function loadApplications() {
  const response = await fetch("/applications");
  applicationsData = await response.json();
  renderTable(applicationsData);
}

function renderTable(data) {
  const tableBody = document.querySelector("#applicationsTable tbody");
  tableBody.innerHTML = "";

  data.forEach(app => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${app.name}</td>
      <td>${app.email}</td>
      <td>${app.phone}</td>
      <td>${app.jobRole}</td>
      <td>${app.message}</td>
      <td>${new Date(app.submittedAt).toLocaleString()}</td>
      <td>
  <span class="status ${app.status}">
    ${app.status}
  </span>
</td>

      <td>
        <button onclick="updateStatus(${app.id}, 'Approved')">Approve</button>
<button onclick="updateStatus(${app.id}, 'Rejected')">Reject</button>
<button onclick="deleteApp(${app.id})">Delete</button>

      </td>
    `;

    tableBody.appendChild(row);
  });
}

async function updateStatus(id, status) {
  await fetch(`/update-status/${id}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ status })
  });

  loadApplications();
}


document.getElementById("searchInput").addEventListener("input", function () {
  const value = this.value.toLowerCase();

  const filtered = applicationsData.filter(app =>
    app.name.toLowerCase().includes(value) ||
    app.email.toLowerCase().includes(value) ||
    app.jobRole.toLowerCase().includes(value)
  );

  renderTable(filtered);
});

loadApplications();
setInterval(loadApplications, 3000);
async function deleteApp(id) {
  await fetch(`/delete/${id}`, {
    method: "DELETE"
  });

  loadApplications();
}


</script>
